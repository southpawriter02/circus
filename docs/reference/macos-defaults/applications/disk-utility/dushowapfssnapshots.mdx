# Disk Utility Show APFS Snapshots

Display APFS snapshots in the Disk Utility sidebar.

## Overview

| Property | Value |
|----------|-------|
| **Domain** | `com.apple.DiskUtility` |
| **Key** | `DUShowAPFSSnapshots` |
| **Type** | Boolean |
| **Default Value** | `false` |
| **Our Setting** | `true` |

## Description

Controls whether APFS (Apple File System) snapshots are displayed in Disk Utility's sidebar. APFS snapshots are point-in-time copies of the file system, created automatically by Time Machine, macOS updates, and other system operations. Showing snapshots helps you understand disk space usage and manage backup states.

## Values

| Value | Behavior |
|-------|----------|
| `true` | **Show snapshots** â€” Display APFS snapshots in sidebar |
| `false` | **Hide snapshots** (default) â€” Snapshots not visible in sidebar |

## Visual Demonstration

### With Snapshots Visible:
```
+-------------------------------------------------------------+
|  Disk Utility - APFS Snapshots Shown                         |
+-------------------------------------------------------------+
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” |
|  â”‚  SIDEBAR                      â”‚  VOLUME INFO           â”‚ |
|  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ |
|  â”‚                               â”‚                        â”‚ |
|  â”‚  Internal                     â”‚  Macintosh HD          â”‚ |
|  â”‚  â”œâ”€â”€ APPLE SSD AP0512Q        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ |
|  â”‚  â”‚   â”œâ”€â”€ Container disk1      â”‚                        â”‚ |
|  â”‚  â”‚   â”‚   â”œâ”€â”€ Macintosh HD     â”‚  Type: APFS Volume     â”‚ |
|  â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“¸ Snapshot  â”‚  Capacity: 500 GB      â”‚ |
|  â”‚  â”‚   â”‚   â”‚   â”‚   2024-01-08   â”‚  Used: 250 GB          â”‚ |
|  â”‚  â”‚   â”‚   â”‚   â”œâ”€â”€ ðŸ“¸ Snapshot  â”‚  Available: 250 GB     â”‚ |
|  â”‚  â”‚   â”‚   â”‚   â”‚   2024-01-07   â”‚                        â”‚ |
|  â”‚  â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“¸ Snapshot  â”‚  SNAPSHOTS:            â”‚ |
|  â”‚  â”‚   â”‚   â”‚       2024-01-05   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ |
|  â”‚  â”‚   â”‚   â”œâ”€â”€ Macintosh HD-Dat â”‚  3 snapshots found     â”‚ |
|  â”‚  â”‚   â”‚   â”œâ”€â”€ Preboot          â”‚  Total: 15.2 GB        â”‚ |
|  â”‚  â”‚   â”‚   â”œâ”€â”€ Recovery         â”‚                        â”‚ |
|  â”‚  â”‚   â”‚   â””â”€â”€ VM               â”‚  [Delete Snapshots...] â”‚ |
|  â”‚                               â”‚                        â”‚ |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ |
|                                                              |
|  âœ“ See all Time Machine local snapshots                     |
|  âœ“ Identify disk space used by snapshots                    |
|  âœ“ Delete old snapshots to reclaim space                    |
|  âœ“ Understand backup history                                |
|                                                              |
+-------------------------------------------------------------+
```

### What Are APFS Snapshots?
```
+-------------------------------------------------------------+
|  Understanding APFS Snapshots                                |
+-------------------------------------------------------------+
|                                                              |
|  WHAT THEY ARE:                                              |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|  Snapshots are instant, read-only copies of your file       |
|  system at a specific moment. They're space-efficient,      |
|  only storing the differences from the current state.       |
|                                                              |
|  Timeline:                                                   |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  Monday     Tuesday    Wednesday  Thursday   Today          |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|    ðŸ“¸         ðŸ“¸          ðŸ“¸         ðŸ“¸        Current      |
|    â†“          â†“           â†“          â†“         State        |
|  Snapshot  Snapshot   Snapshot   Snapshot    â”Œâ”€â”€â”€â”€â”€â”        |
|    #1        #2         #3         #4        â”‚ Now â”‚        |
|                                              â””â”€â”€â”€â”€â”€â”˜        |
|                                                              |
|  WHO CREATES THEM:                                           |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|  â€¢ Time Machine (hourly when backup drive not connected)    |
|  â€¢ macOS updates (before installing updates)                |
|  â€¢ Some backup software (Carbon Copy Cloner, etc.)          |
|  â€¢ Manual creation via tmutil command                       |
|                                                              |
|  SPACE USAGE:                                                |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|  â€¢ Initially: Near zero (just metadata)                     |
|  â€¢ Over time: Grows as files change                         |
|  â€¢ Deleted when: Space needed or manually removed           |
|                                                              |
+-------------------------------------------------------------+
```

### Without Snapshots (Hidden):
```
+-------------------------------------------------------------+
|  Disk Utility - Snapshots Hidden (Default)                   |
+-------------------------------------------------------------+
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” |
|  â”‚  SIDEBAR                      â”‚  VOLUME INFO           â”‚ |
|  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ |
|  â”‚                               â”‚                        â”‚ |
|  â”‚  Internal                     â”‚  Macintosh HD          â”‚ |
|  â”‚  â”œâ”€â”€ APPLE SSD AP0512Q        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ |
|  â”‚  â”‚   â””â”€â”€ Container disk1      â”‚                        â”‚ |
|  â”‚  â”‚       â”œâ”€â”€ Macintosh HD     â”‚  Type: APFS Volume     â”‚ |
|  â”‚  â”‚       â”œâ”€â”€ Macintosh HD-Dat â”‚  Capacity: 500 GB      â”‚ |
|  â”‚  â”‚       â”œâ”€â”€ Preboot          â”‚  Used: 250 GB          â”‚ |
|  â”‚  â”‚       â”œâ”€â”€ Recovery         â”‚  Available: 250 GB     â”‚ |
|  â”‚  â”‚       â””â”€â”€ VM               â”‚                        â”‚ |
|  â”‚                               â”‚  (No snapshot info)    â”‚ |
|  â”‚  External                     â”‚                        â”‚ |
|  â”‚  â””â”€â”€ ...                      â”‚                        â”‚ |
|  â”‚                               â”‚                        â”‚ |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ |
|                                                              |
|  âœ— Snapshots exist but are hidden                          |
|  âœ— Can't see snapshot space usage                          |
|  âœ— Must use terminal to manage snapshots                   |
|                                                              |
+-------------------------------------------------------------+
```

## Our Configuration

**Set to**: `true` â€” Show snapshots to understand disk space usage.

### Why Show Snapshots?

1. **Space awareness** â€” See how much space snapshots consume
2. **Troubleshooting** â€” Diagnose "where did my space go?" issues
3. **Management** â€” Delete unnecessary snapshots easily
4. **Backup visibility** â€” Understand local Time Machine snapshots
5. **Transparency** â€” See what's actually on your disk

### Why Hide Snapshots?

- Simpler interface for basic users
- Less clutter in sidebar
- Snapshots managed automatically
- Rarely need to interact with them

## Code Examples

```bash
# Read current value
defaults read com.apple.DiskUtility DUShowAPFSSnapshots

# Show APFS snapshots
defaults write com.apple.DiskUtility DUShowAPFSSnapshots -bool true

# Hide APFS snapshots (default)
defaults write com.apple.DiskUtility DUShowAPFSSnapshots -bool false

# Delete (reset to default)
defaults delete com.apple.DiskUtility DUShowAPFSSnapshots
```

## Managing Snapshots via Terminal

```bash
# List all local snapshots
tmutil listlocalsnapshots /

# List snapshots with dates
tmutil listlocalsnapshotdates

# Delete a specific snapshot
sudo tmutil deletelocalsnapshots 2024-01-08-120000

# Delete all local snapshots
sudo tmutil deletelocalsnapshots /

# Check snapshot space usage
sudo du -sh /.MobileBackups* 2>/dev/null
```

## UI Location

This is a defaults-only setting. Related View menu options in Disk Utility:

```
+-------------------------------------------------------------+
|  Disk Utility View Options                                   |
+-------------------------------------------------------------+
|                                                              |
|  View                                                        |
|  â”œâ”€â”€ Show All Devices              âŒ˜2                       |
|  â”‚    (Shows full disk hierarchy)                           |
|  â”œâ”€â”€ Show Only Volumes             âŒ˜1                       |
|  â”‚    (Simplified view)                                     |
|  â”œâ”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      |
|  â”œâ”€â”€ Show APFS Snapshots                                    |
|  â”‚    (May not appear in menu -                             |
|  â”‚     controlled by defaults)                              |
|  â””â”€â”€ ...                                                    |
|                                                              |
|  Note: The defaults command is the reliable way to          |
|  enable snapshot visibility.                                 |
|                                                              |
+-------------------------------------------------------------+
```

## Snapshot Space Recovery

```
+-------------------------------------------------------------+
|  Reclaiming Space from Snapshots                             |
+-------------------------------------------------------------+
|                                                              |
|  SCENARIO: "My disk shows 50GB used but Finder says less"   |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  Often caused by APFS snapshots holding deleted files:      |
|                                                              |
|  1. You delete 20GB of files                                |
|  2. Files removed from current view                         |
|  3. BUT snapshots still reference those files               |
|  4. Space not truly freed until snapshots expire/deleted    |
|                                                              |
|  TO RECLAIM SPACE:                                           |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  Option 1: Wait                                              |
|  â€¢ macOS auto-deletes old snapshots when space needed       |
|  â€¢ Time Machine snapshots expire after 24 hours             |
|                                                              |
|  Option 2: Delete manually (Terminal)                        |
|  tmutil listlocalsnapshots /                                |
|  sudo tmutil deletelocalsnapshots 2024-01-08-120000         |
|                                                              |
|  Option 3: Disk Utility (with setting enabled)              |
|  â€¢ Select volume in sidebar                                 |
|  â€¢ Expand to see snapshots                                  |
|  â€¢ Right-click > Delete                                     |
|                                                              |
|  âš ï¸ WARNING: Deleting snapshots removes recovery points!   |
|                                                              |
+-------------------------------------------------------------+
```

## Related Settings

```bash
# Show APFS snapshots (this setting)
defaults write com.apple.DiskUtility DUShowAPFSSnapshots -bool true

# Show all devices in sidebar
defaults write com.apple.DiskUtility SidebarShowAllDevices -bool true

# Enable debug menu
defaults write com.apple.DiskUtility DUDebugMenuEnabled -bool true

# Advanced image options
defaults write com.apple.DiskUtility advanced-image-options -bool true

# Confirm before erase
defaults write com.apple.DiskUtility DUAskBeforeErase -bool true
```

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Snapshots not showing | Restart Disk Utility after changing setting |
| Can't delete snapshot | Need admin privileges; use sudo in Terminal |
| "No snapshots" but space used | Check with `tmutil listlocalsnapshots /` |
| Disk space not freed after delete | APFS space reclamation may be delayed |
| Snapshot list won't load | Try View > Show All Devices first |

## Compatibility

- **Disk Utility**: macOS 10.13+ (High Sierra)
- **Note**: Only works with APFS-formatted volumes
- **Note**: HFS+ volumes don't support snapshots
- **Note**: External drives may not show snapshots
- **Note**: Some snapshots are protected (macOS update snapshots)

## Source File

**File**: [`defaults/applications/disk_utility.sh`](../../../../../defaults/applications/disk_utility.sh)

```bash
run_defaults "com.apple.DiskUtility" "DUShowAPFSSnapshots" "-bool" "true"
```

## References

- [Apple Support: Disk Utility User Guide](https://support.apple.com/guide/disk-utility/welcome/mac)
- [Apple Support: About APFS snapshots](https://support.apple.com/en-us/HT204015)
- [Apple Support: Time Machine local snapshots](https://support.apple.com/en-us/HT204015)
