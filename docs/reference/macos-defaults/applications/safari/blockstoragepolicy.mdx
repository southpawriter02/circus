# Safari Block Storage Policy

Configure cookie and website data storage blocking for enhanced privacy.

## Overview

| Property | Value |
|----------|-------|
| **Domain** | `com.apple.Safari` |
| **Key** | `BlockStoragePolicy` |
| **Type** | Integer |
| **Default Value** | `2` |
| **Our Setting** | `2` |

## Description

Controls Safari's policy for blocking cookies and website data storage. This setting determines which websites can store cookies and other data on your Mac, balancing privacy protection against website functionality. Modern privacy-focused configurations block all third-party cookies to prevent cross-site tracking while allowing first-party cookies for site functionality.

## Values

| Value | Behavior |
|-------|----------|
| `0` | **Allow all cookies** â€” No blocking (least private) |
| `1` | **Block third-party cookies** â€” Allow from visited sites only |
| `2` | **Block all third-party cookies** (default) â€” Strict blocking |
| `3` | **Block all cookies** â€” Complete blocking (may break sites) |

## Visual Demonstration

### Cookie Blocking Levels:
```
+-------------------------------------------------------------+
|  Safari Cookie Storage Policy                                |
+-------------------------------------------------------------+
|                                                              |
|  VALUE 0 (Allow All):                                        |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        |
|  â”‚   Site A    â”‚   â”‚   Site B    â”‚   â”‚  Ad Network â”‚        |
|  â”‚   ğŸª âœ“      â”‚   â”‚   ğŸª âœ“      â”‚   â”‚   ğŸª âœ“      â”‚        |
|  â”‚  (1st party)â”‚   â”‚ (3rd party) â”‚   â”‚ (tracker)   â”‚        |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        |
|        â†“                 â†“                 â†“                 |
|  All cookies stored   All stored     Trackers stored        |
|                                                              |
|  âš ï¸  PRIVACY RISK: All sites and trackers can store data   |
|                                                              |
+-------------------------------------------------------------+
```

### Block Third-Party (Value 2 - Recommended):
```
+-------------------------------------------------------------+
|  Block Third-Party Cookies (Default)                         |
+-------------------------------------------------------------+
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        |
|  â”‚   Site A    â”‚   â”‚   Site B    â”‚   â”‚  Ad Network â”‚        |
|  â”‚   ğŸª âœ“      â”‚   â”‚   ğŸª âœ—      â”‚   â”‚   ğŸª âœ—      â”‚        |
|  â”‚  (1st party)â”‚   â”‚ (3rd party) â”‚   â”‚ (tracker)   â”‚        |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        |
|        â†“                 â†“                 â†“                 |
|    Allowed          âŒ Blocked         âŒ Blocked            |
|                                                              |
|  HOW IT WORKS:                                               |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  When visiting news.example.com:                            |
|                                                              |
|  âœ“ news.example.com can set cookies (logged in, prefs)      |
|  âœ— ads.tracker.com embedded on page â†’ BLOCKED               |
|  âœ— social.network.com widget â†’ BLOCKED                      |
|  âœ— analytics.service.com â†’ BLOCKED                          |
|                                                              |
|  âœ“ PRIVACY: Prevents cross-site tracking                    |
|  âœ“ FUNCTIONALITY: Sites you visit still work                |
|                                                              |
+-------------------------------------------------------------+
```

### Block All Cookies (Value 3):
```
+-------------------------------------------------------------+
|  Block All Cookies (Most Strict)                             |
+-------------------------------------------------------------+
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        |
|  â”‚   Site A    â”‚   â”‚   Site B    â”‚   â”‚  Ad Network â”‚        |
|  â”‚   ğŸª âœ—      â”‚   â”‚   ğŸª âœ—      â”‚   â”‚   ğŸª âœ—      â”‚        |
|  â”‚  (1st party)â”‚   â”‚ (3rd party) â”‚   â”‚ (tracker)   â”‚        |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        |
|        â†“                 â†“                 â†“                 |
|    âŒ Blocked        âŒ Blocked         âŒ Blocked            |
|                                                              |
|  CONSEQUENCES:                                               |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  âœ— Cannot stay logged in to websites                        |
|  âœ— Shopping carts don't persist                             |
|  âœ— Site preferences not saved                               |
|  âœ— Many sites will not function properly                    |
|                                                              |
|  âš ï¸  NOT RECOMMENDED for normal browsing                    |
|                                                              |
+-------------------------------------------------------------+
```

### Privacy vs Functionality Trade-off:
```
+-------------------------------------------------------------+
|  Cookie Policy Comparison                                    |
+-------------------------------------------------------------+
|                                                              |
|  PRIVACY LEVEL:                                              |
|                                                              |
|  Allow All (0)   â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  Least Private                  |
|  Visited (1)     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  Moderate                       |
|  Block 3rd (2)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  Recommended â˜…                  |
|  Block All (3)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Most Private                   |
|                                                              |
|  SITE COMPATIBILITY:                                         |
|                                                              |
|  Allow All (0)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  Full compatibility             |
|  Visited (1)     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  Most sites work                |
|  Block 3rd (2)   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  Minor issues possible â˜…        |
|  Block All (3)   â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  Many sites broken              |
|                                                              |
|  â˜… = Recommended setting (best balance)                     |
|                                                              |
+-------------------------------------------------------------+
```

## Our Configuration

**Set to**: `2` â€” Block all third-party cookies for strong privacy.

### Why Block Third-Party Cookies?

1. **Prevents tracking** â€” Ad networks can't follow you across sites
2. **Privacy protection** â€” Limits data collection by trackers
3. **Minimal impact** â€” First-party cookies still work
4. **Safari default** â€” Apple's recommended setting
5. **GDPR alignment** â€” Supports privacy regulations

### Why Allow All?

- Testing web applications
- Compatibility with specific sites
- Temporary need for embedded services

### Why Block All?

- Maximum privacy (advanced users)
- Temporary anonymous browsing
- Testing cookie-less experience

## Code Examples

```bash
# Read current value
defaults read com.apple.Safari BlockStoragePolicy

# Allow all cookies (0)
defaults write com.apple.Safari BlockStoragePolicy -int 0

# Block third-party from unvisited sites (1)
defaults write com.apple.Safari BlockStoragePolicy -int 1

# Block all third-party cookies (2, recommended)
defaults write com.apple.Safari BlockStoragePolicy -int 2

# Block all cookies (3)
defaults write com.apple.Safari BlockStoragePolicy -int 3

# Delete (reset to default)
defaults delete com.apple.Safari BlockStoragePolicy
```

## UI Location

**Safari** > **Settings** > **Privacy** > **Cookies and website data**

```
+-------------------------------------------------------------+
|  Safari Settings - Privacy                                   |
+-------------------------------------------------------------+
|                                                              |
|  Safari > Settings (âŒ˜,) > Privacy                           |
|  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  |
|                                                              |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”|
|  â”‚  [General] [Tabs] [AutoFill] [Passwords] [Search]       â”‚|
|  â”‚  [Security] [Privacy] [Websites] [Extensions] [Advanced]â”‚|
|  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚|
|  â”‚                                                          â”‚|
|  â”‚  Website tracking                                        â”‚|
|  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚|
|  â”‚                                                          â”‚|
|  â”‚  [âœ“] Prevent cross-site tracking      â† Related         â”‚|
|  â”‚                                                          â”‚|
|  â”‚  Cookies and website data                                â”‚|
|  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚|
|  â”‚                                                          â”‚|
|  â”‚  [Block all cookies                    â–¼]                â”‚|
|  â”‚                                         â†‘                â”‚|
|  â”‚  Options:                              This setting      â”‚|
|  â”‚  â€¢ Allow all cookies                                     â”‚|
|  â”‚  â€¢ Block third-party cookies (default)                  â”‚|
|  â”‚  â€¢ Block all cookies                                     â”‚|
|  â”‚                                                          â”‚|
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜|
|                                                              |
+-------------------------------------------------------------+
```

## Related Settings

```bash
# Cookie blocking policy (this setting)
defaults write com.apple.Safari BlockStoragePolicy -int 2

# Prevent cross-site tracking
defaults write com.apple.Safari WebKitStorageBlockingPolicy -int 1

# Do Not Track header
defaults write com.apple.Safari SendDoNotTrackHTTPHeader -bool true

# Fraudulent website warning
defaults write com.apple.Safari WarnAboutFraudulentWebsites -bool true

# Preload top hit (disable for privacy)
defaults write com.apple.Safari PreloadTopHit -bool false
```

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Can't log into websites | Check if cookies are completely blocked; use value 2 instead of 3 |
| Shopping cart not saving | Site may require third-party cookies; add to allowed list |
| Social login not working | Social login uses third-party cookies; log in directly instead |
| Site says "enable cookies" | Likely requires third-party; consider adding exception |
| Changes not taking effect | Restart Safari; clear existing website data |

## Security Implications

- **Privacy**: Blocking third-party cookies significantly reduces tracking
- **Fingerprinting**: This setting doesn't prevent browser fingerprinting
- **Storage**: Also affects localStorage and IndexedDB for third parties
- **ITP**: Works alongside Safari's Intelligent Tracking Prevention

## Compatibility

- **macOS**: 10.11+ (El Capitan and later)
- **Safari**: 11.0+ (full third-party blocking support)
- **Note**: Safari uses Intelligent Tracking Prevention (ITP) in addition to this setting
- **Note**: Restart Safari for changes to take effect
- **Note**: Some sites may prompt you to enable cookies

## Source File

**File**: [`defaults/profiles/privacy.sh`](../../../../../defaults/profiles/privacy.sh)

```bash
# --- Prevent Cross-Site Tracking ---
# Key:          BlockStoragePolicy
# Description:  Blocks websites from tracking you across the web
run_defaults "com.apple.Safari" "BlockStoragePolicy" "-int" "2"
```

## References

- [Apple Support: Safari Privacy settings](https://support.apple.com/guide/safari/privacy-ibrw1074/mac)
- [Apple Support: Prevent cross-site tracking](https://support.apple.com/guide/safari/prevent-cross-site-tracking-sfri40732/mac)
- [WebKit: Intelligent Tracking Prevention](https://webkit.org/tracking-prevention/)
