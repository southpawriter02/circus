#!/usr/bin/env bash\n\n# ==============================================================================\n#\n# Defaults: Visual Studio Code Configuration\n#\n# This script automates the setup of Visual Studio Code by installing a\n# curated list of extensions and symlinking a settings file.\n#\n# ==============================================================================\n\nmain() {\n  msg_info \"Configuring Visual Studio Code...\"\n\n  # --- Prerequisite Check ---\n  if ! command -v code >/dev/null 2>&1; then\n    msg_warning \"Visual Studio Code command-line tool \'code\' not found. Skipping.\"\n    msg_info \"Please ensure VS Code is installed and the \'Shell Command: Install \\'code\\' command in PATH\' has been run.\"\n    return 1\n  fi\n\n  # --- Configuration ---\n  local extensions_file=\"$DOTFILES_DIR/etc/vscode/extensions.txt\"\n  local settings_source=\"$DOTFILES_DIR/etc/vscode/settings.json\"\n  local settings_target_dir=\"$HOME/Library/Application Support/Code/User\"\n  local settings_target_file=\"$settings_target_dir/settings.json\"\n\n  # --- Extension Installation ---\n  if [ -f \"$extensions_file\" ]; then\n    msg_info \"Installing VS Code extensions from $extensions_file...\"\n    # Read the file line by line, ignoring comments and empty lines.\n    grep -v \'^\s*#\' \"$extensions_file\" | grep -v \'^\s*$\' | while read -r extension; do\n      if [ \"$DRY_RUN_MODE\" = true ]; then\n        msg_info \"[Dry Run] Would install extension: $extension\"\n      else\n        if code --install-extension \"$extension\" --force; then\n          msg_success \"Installed extension: $extension\"\n        else\n          msg_error \"Failed to install extension: $extension\"\n        fi\n      fi\n    done\n  else\n    msg_warning \"VS Code extensions file not found. Skipping installation.\"\n  fi\n\n  # --- Settings Symlinking ---\n  msg_info \"Symlinking VS Code settings...\"\n  if [ \"$DRY_RUN_MODE\" = true ]; then\n    msg_info \"[Dry Run] Would ensure directory exists: $settings_target_dir\"\n    msg_info \"[Dry Run] Would back up existing settings at $settings_target_file\"\n    msg_info \"[Dry Run] Would symlink \'$settings_source\' to \'$settings_target_file\'\"\n  else\n    # Ensure the target directory exists.\n    mkdir -p \"$settings_target_dir\"\n\n    # Back up existing settings file if it\'s not already a symlink.\n    if [ -f \"$settings_target_file\" ] && [ ! -L \"$settings_target_file\" ]; then\n      mv \"$settings_target_file\" \"${settings_target_file}.bak\"\n      msg_info \"Backed up existing settings to ${settings_target_file}.bak\"\n    fi\n\n    # Create the symlink.\n    if ln -sf \"$settings_source\" \"$settings_target_file\"; then\n      msg_success \"Symlinked VS Code settings file.\"\n    else\n      msg_error \"Failed to symlink VS Code settings file.\"\n    fi\n  fi\n\n  msg_success \"Visual Studio Code configuration complete.\"\n}\n\nmain\n