#!/usr/bin/env bash

# ==============================================================================
#
# FILE:         wifi
#
# DESCRIPTION:  This command manages the system's Wi-Fi adapter.
#
# ==============================================================================

# --- Setup ------------------------------------------------------------------
# Source the helper library to get the error handling and logging functions.
source "$(dirname "${BASH_SOURCE[0]}")/../lib/helpers.sh"

# --- Help and Usage ---------------------------------------------------------
usage() {
  msg_info "Usage: fc wifi <action>"
  echo ""
  msg_info "Manages the system's Wi-Fi adapter."
  echo ""
  msg_info "Actions:"
  echo "  on      - Turn Wi-Fi on."
  echo "  off     - Turn Wi-Fi off."
  echo "  status  - Show the current Wi-Fi status."
  echo ""
  exit 0
}

# --- Main Logic -------------------------------------------------------------
main() {
  if [ -z "$1" ] || [ "$1" == "--help" ]; then
    usage
  fi

  # Find the primary Wi-Fi hardware port (usually en0 or en1).
  local wifi_port
  wifi_port=$(networksetup -listallhardwareports | awk '/Wi-Fi|AirPort/{getline; print $2}')

  if [ -z "$wifi_port" ]; then
    die "No active Wi-Fi hardware port found."
  fi

  ACTION="$1"

  case "$ACTION" in
    on)
      msg_info "Turning Wi-Fi on..."
      networksetup -setairportpower "$wifi_port" on
      msg_success "Wi-Fi is now on."
      ;;
    off)
      msg_info "Turning Wi-Fi off..."
      networksetup -setairportpower "$wifi_port" off
      msg_success "Wi-Fi is now off."
      ;;
    status)
      msg_info "Checking Wi-Fi status..."
      networksetup -getairportpower "$wifi_port"
      ;;
    *)
      die "Unknown action '$ACTION'. Run 'fc wifi --help' for available actions."
      ;;
  esac
}

main "$@"
