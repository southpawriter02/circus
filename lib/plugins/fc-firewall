#!/usr/bin/env bash

# ==============================================================================
#
# FILE:         fc-firewall
#
# DESCRIPTION:  Manage the system firewall from the command line.
#               Provides simple on/off control and status checking.
#
# CROSS-PLATFORM:
#   - macOS: Uses socketfilterfw (Application Firewall)
#   - Linux: Uses ufw or firewalld
#
# REQUIRES:
#   - macOS 10.5.1+ or Linux with ufw/firewalld
#   - Administrator privileges (sudo) for all operations
#
# ACTIONS:
#   on      - Turn the firewall on
#   off     - Turn the firewall off
#   status  - Show current firewall state
#
# EXAMPLES:
#   fc firewall on        # Enable firewall
#   fc firewall off       # Disable firewall
#   fc firewall status    # Check if firewall is enabled
#
# NOTES:
#   - macOS: Application-level firewall (incoming connections only)
#   - Linux: ufw or firewalld (full packet filtering)
#   - All operations require sudo/administrator privileges
#
# ==============================================================================

# --- Initialization ---------------------------------------------------------
source "$(dirname "${BASH_SOURCE[0]}")/../init.sh"

# --- Help and Usage ---------------------------------------------------------
usage() {
  msg_info "Usage: fc firewall <action>"
  echo ""
  msg_info "Manages the system firewall."
  msg_info "This command requires administrator privileges."
  echo ""
  msg_info "Actions:"
  echo "  on      - Turn the firewall on."
  echo "  off     - Turn the firewall off."
  echo "  status  - Show the current firewall status."
  echo ""
  msg_info "Examples:"
  echo "  fc firewall on       # Enable firewall"
  echo "  fc firewall status   # Check current state"
  echo ""
  if is_linux; then
    msg_info "Linux: Requires ufw or firewalld"
  fi
  exit 0
}

# --- Main Logic -------------------------------------------------------------
main() {
  if [ -z "$1" ] || [ "$1" == "--help" ]; then
    usage
  fi

  ACTION="$1"

  case "$ACTION" in

    # --- Action: on ---------------------------------------------------------
    on)
      msg_info "Turning the firewall on..."
      os_firewall_on
      msg_success "Firewall is now on."
      ;;

    # --- Action: off --------------------------------------------------------
    off)
      msg_info "Turning the firewall off..."
      os_firewall_off
      msg_success "Firewall is now off."
      ;;

    # --- Action: status -----------------------------------------------------
    status)
      msg_info "Checking firewall status..."
      os_firewall_status
      ;;

    *)
      die "Unknown action '$ACTION'. Run 'fc firewall --help' for available actions."
      ;;
  esac
}

main "$@"
