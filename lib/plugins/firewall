#!/usr/bin/env bash

# ==============================================================================
#
# FILE:         firewall
#
# DESCRIPTION:  This command manages the macOS application firewall.
#
# ==============================================================================

# --- Initialization ---------------------------------------------------------
# Source the centralized initialization script to set up the environment.
source "$(dirname "${BASH_SOURCE[0]}")/../init.sh"

# --- Help and Usage ---------------------------------------------------------
usage() {
  msg_info "Usage: fc firewall <action>"
  echo ""
  msg_info "Manages the macOS application firewall."
  msg_info "This command requires administrator privileges to change settings."
  echo ""
  msg_info "Actions:"
  echo "  on      - Turn the firewall on."
  echo "  off     - Turn the firewall off."
  echo "  status  - Show the current firewall status."
  echo ""
  exit 0
}

# --- Main Logic -------------------------------------------------------------
main() {
  if [ -z "$1" ] || [ "$1" == "--help" ]; then
    usage
  fi

  ACTION="$1"

  case "$ACTION" in
    on)
      msg_info "Turning the firewall on..."
      sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
      msg_success "Firewall is now on."
      ;;
    off)
      msg_info "Turning the firewall off..."
      sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off
      msg_success "Firewall is now off."
      ;;
    status)
      msg_info "Checking firewall status..."
      sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
      ;;
    *)
      die "Unknown action '$ACTION'. Run 'fc firewall --help' for available actions."
      ;;
  esac
}

main "$@"
